#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if SKIP_TESTS is set to true
if [ "$SKIP_TESTS" = "true" ]; then
  echo "âš ï¸ Skipping tests due to SKIP_TESTS=true"
  echo "âš ï¸ This should only be used for emergency fixes!"
  RUN_TESTS=false
else
  RUN_TESTS=true
fi

echo "Running pre-commit checks..."

# Run lint-staged to process only changed files
echo "ğŸ” Running lint-staged..."
npx lint-staged || { echo "âŒ Linting failed"; exit 1; }

# Check TypeScript compilation
echo "ğŸ” Checking TypeScript compilation..."
npx tsc --noEmit || { echo "âŒ TypeScript check failed"; exit 1; }

# Run tests
if [ "$RUN_TESTS" = "true" ]; then
  echo "ğŸ§ª Running tests..."
  npm test || { echo "âŒ Tests failed"; exit 1; }
fi

# If everything passes, allow the commit
echo "âœ… Pre-commit checks passed!" 